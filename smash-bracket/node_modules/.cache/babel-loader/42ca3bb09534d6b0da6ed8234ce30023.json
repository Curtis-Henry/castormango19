{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WebAuth0AuthClient = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _auth0Js = _interopRequireDefault(require(\"auth0-js\"));\n\nvar R = _interopRequireWildcard(require(\"ramda\"));\n\nvar localStorageAccessor = _interopRequireWildcard(require(\"./localStorageAccessor\"));\n\nvar isEmptyOrNil = R.either(R.isNil, R.isEmpty);\nvar isEmailVerified = R.pipe(R.path(['idTokenPayload', 'email_verified']), R.equals(true));\nvar getEmail = R.path(['idTokenPayload', 'email']);\nvar getIdToken = R.path(['idToken']);\nvar getIdTokenPayload = R.prop('idTokenPayload');\nvar getState = R.pipe(R.prop('state'), function (state) {\n  try {\n    return JSON.parse(state);\n  } catch (e) {\n    return state;\n  }\n});\n/**\r\n * Create instacne of the web auth0 auth client.\r\n * @param {string} workspaceId Identifier of the 8base app workspace.\r\n * @param {string} domain Domain. See auth0 documentation.\r\n * @param {string} clientId Client id. See auth0 documentation.\r\n * @param {string} redirectUri Redurect uri. See auth0 documentation.\r\n */\n\nvar WebAuth0AuthClient =\n/*#__PURE__*/\nfunction () {\n  function WebAuth0AuthClient(_ref) {\n    var _this = this;\n\n    var domain = _ref.domain,\n        clientId = _ref.clientId,\n        redirectUri = _ref.redirectUri,\n        workspaceId = _ref.workspaceId,\n        logoutRedirectUri = _ref.logoutRedirectUri;\n    (0, _classCallCheck2.default)(this, WebAuth0AuthClient);\n    (0, _defineProperty2.default)(this, \"auth0\", void 0);\n    (0, _defineProperty2.default)(this, \"workspaceId\", void 0);\n    (0, _defineProperty2.default)(this, \"logoutRedirectUri\", void 0);\n    (0, _defineProperty2.default)(this, \"authorize\",\n    /*#__PURE__*/\n    (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee() {\n      var options,\n          _args = arguments;\n      return _regenerator.default.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              options = _args.length > 0 && _args[0] !== undefined ? _args[0] : {};\n\n              _this.auth0.authorize((0, _objectSpread2.default)({\n                state: _this.getAuthorizeState()\n              }, options));\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this);\n    })));\n    (0, _defineProperty2.default)(this, \"renewToken\", function () {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      return new Promise(function (resolve, reject) {\n        _this.auth0.checkSession(options, function (error, result) {\n          if (error) {\n            reject(error || {});\n            return;\n          }\n\n          resolve({\n            state: getState(result),\n            email: getEmail(result),\n            idToken: getIdToken(result),\n            isEmailVerified: isEmailVerified(result),\n            idTokenPayload: getIdTokenPayload(result)\n          });\n        });\n      });\n    });\n    (0, _defineProperty2.default)(this, \"changePassword\",\n    /*#__PURE__*/\n    (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee2() {\n      var _ref4, email;\n\n      return _regenerator.default.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return _this.getAuthState();\n\n            case 2:\n              _ref4 = _context2.sent;\n              email = _ref4.email;\n              return _context2.abrupt(\"return\", new Promise(function (resolve, reject) {\n                _this.auth0.changePassword({\n                  connection: 'Username-Password-Authentication',\n                  email: email\n                }, function (error) {\n                  if (error) {\n                    reject(error || {});\n                    return;\n                  }\n\n                  resolve({\n                    email: email\n                  });\n                });\n              }));\n\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, this);\n    })));\n    (0, _defineProperty2.default)(this, \"getAuthorizedData\", function () {\n      return new Promise(function (resolve, reject) {\n        _this.auth0.parseHash(function (error, authResult) {\n          if (error) {\n            reject(error);\n            return;\n          }\n\n          resolve({\n            state: getState(authResult),\n            email: getEmail(authResult),\n            idToken: getIdToken(authResult),\n            isEmailVerified: isEmailVerified(authResult),\n            idTokenPayload: getIdTokenPayload(authResult)\n          });\n        });\n      });\n    });\n    (0, _defineProperty2.default)(this, \"setAuthState\",\n    /*#__PURE__*/\n    function () {\n      var _ref5 = (0, _asyncToGenerator2.default)(\n      /*#__PURE__*/\n      _regenerator.default.mark(function _callee3(state) {\n        return _regenerator.default.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                localStorageAccessor.setAuthState(state);\n\n              case 1:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      return function (_x) {\n        return _ref5.apply(this, arguments);\n      };\n    }());\n    (0, _defineProperty2.default)(this, \"getAuthState\",\n    /*#__PURE__*/\n    (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee4() {\n      return _regenerator.default.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              return _context4.abrupt(\"return\", localStorageAccessor.getAuthState());\n\n            case 1:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, this);\n    })));\n    (0, _defineProperty2.default)(this, \"purgeAuthState\",\n    /*#__PURE__*/\n    (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee5() {\n      return _regenerator.default.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              localStorageAccessor.purgeAuthState();\n\n            case 1:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5, this);\n    })));\n    (0, _defineProperty2.default)(this, \"checkIsAuthorized\",\n    /*#__PURE__*/\n    (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee6() {\n      var _ref9, token;\n\n      return _regenerator.default.wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.next = 2;\n              return _this.getAuthState();\n\n            case 2:\n              _ref9 = _context6.sent;\n              token = _ref9.token;\n              return _context6.abrupt(\"return\", R.not(isEmptyOrNil(token)));\n\n            case 5:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6, this);\n    })));\n    (0, _defineProperty2.default)(this, \"logout\",\n    /*#__PURE__*/\n    (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee7() {\n      var options,\n          _args7 = arguments;\n      return _regenerator.default.wrap(function _callee7$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              options = _args7.length > 0 && _args7[0] !== undefined ? _args7[0] : {};\n\n              _this.auth0.logout((0, _objectSpread2.default)({\n                returnTo: _this.logoutRedirectUri\n              }, options));\n\n            case 2:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee7, this);\n    })));\n    this.workspaceId = workspaceId;\n    this.logoutRedirectUri = logoutRedirectUri;\n    this.auth0 = new _auth0Js.default.WebAuth({\n      domain: domain,\n      clientID: clientId,\n      redirectUri: redirectUri,\n      mustAcceptTerms: true,\n      responseType: 'token id_token',\n      scope: 'openid email profile',\n      state: this.getAuthorizeState()\n    });\n  }\n\n  (0, _createClass2.default)(WebAuth0AuthClient, [{\n    key: \"getAuthorizeState\",\n    value: function getAuthorizeState() {\n      return this.workspaceId ? JSON.stringify({\n        workspaceId: this.workspaceId\n      }) : undefined;\n    }\n  }]);\n  return WebAuth0AuthClient;\n}();\n\nexports.WebAuth0AuthClient = WebAuth0AuthClient;","map":null,"metadata":{},"sourceType":"script"}