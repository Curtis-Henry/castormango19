{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ApolloContainer = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf3 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar R = _interopRequireWildcard(require(\"ramda\"));\n\nvar _reactApollo = require(\"react-apollo\");\n\nvar _apolloClient = require(\"@8base/apollo-client\");\n\nvar _apolloCacheInmemory = require(\"apollo-cache-inmemory\");\n\nvar _auth = require(\"@8base/auth\");\n\nvar _FragmentsSchemaContainer = require(\"./FragmentsSchemaContainer\");\n\nvar ApolloContainer =\n/*#__PURE__*/\nfunction (_React$Component) {\n  (0, _inherits2.default)(ApolloContainer, _React$Component);\n\n  function ApolloContainer() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    (0, _classCallCheck2.default)(this, ApolloContainer);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = (0, _possibleConstructorReturn2.default)(this, (_getPrototypeOf2 = (0, _getPrototypeOf3.default)(ApolloContainer)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), \"onIdTokenExpired\",\n    /*#__PURE__*/\n    (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee() {\n      var _this$props$auth, setAuthState, renewToken, _ref2, idToken;\n\n      return _regenerator.default.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this$props$auth = _this.props.auth, setAuthState = _this$props$auth.setAuthState, renewToken = _this$props$auth.renewToken;\n              _context.next = 3;\n              return renewToken({});\n\n            case 3:\n              _ref2 = _context.sent;\n              idToken = _ref2.idToken;\n              _context.next = 7;\n              return setAuthState({\n                token: idToken\n              });\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this);\n    })));\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), \"onAuthError\",\n    /*#__PURE__*/\n    (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee2() {\n      var _this$props$auth2, purgeAuthState, logout;\n\n      return _regenerator.default.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _this$props$auth2 = _this.props.auth, purgeAuthState = _this$props$auth2.purgeAuthState, logout = _this$props$auth2.logout;\n              _context2.next = 3;\n              return purgeAuthState();\n\n            case 3:\n              if (!(typeof logout === 'function')) {\n                _context2.next = 6;\n                break;\n              }\n\n              _context2.next = 6;\n              return logout();\n\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, this);\n    })));\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), \"getAuthState\", function () {\n      var authState = _this.props.auth.authState;\n\n      if (authState) {\n        return R.pick(['token', 'workspaceId'])(authState);\n      }\n\n      return null;\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), \"createClient\", R.memoize(function (fragmentsSchema) {\n      return new _apolloClient.EightBaseApolloClient({\n        getAuthState: _this.getAuthState,\n        getRefreshTokenParameters: _this.getRefreshTokenParameters,\n        onAuthError: _this.onAuthError,\n        uri: _this.props.uri,\n        extendLinks: _this.props.extendLinks,\n        onRequestSuccess: _this.props.onRequestSuccess,\n        onRequestError: _this.props.onRequestError,\n        cache: new _apolloCacheInmemory.InMemoryCache({\n          fragmentMatcher: new _apolloCacheInmemory.IntrospectionFragmentMatcher({\n            introspectionQueryResultData: fragmentsSchema\n          })\n        })\n      });\n    }));\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), \"renderContent\", function (_ref4) {\n      var loading = _ref4.loading,\n          fragmentsSchema = _ref4.fragmentsSchema;\n\n      if (loading) {\n        return null;\n      }\n\n      _this.client = _this.createClient(fragmentsSchema);\n      return _react.default.createElement(_reactApollo.ApolloProvider, {\n        client: _this.client\n      }, _this.props.children);\n    });\n    return _this;\n  }\n\n  (0, _createClass2.default)(ApolloContainer, [{\n    key: \"render\",\n    value: function render() {\n      var uri = this.props.uri;\n      return _react.default.createElement(_FragmentsSchemaContainer.FragmentsSchemaContainer, {\n        uri: uri\n      }, this.renderContent);\n    }\n  }]);\n  return ApolloContainer;\n}(_react.default.Component);\n\nexports.ApolloContainer = ApolloContainer;\nexports.ApolloContainer = ApolloContainer = (0, _auth.withAuth)(ApolloContainer);","map":null,"metadata":{},"sourceType":"script"}